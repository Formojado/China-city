// 请确保这段代码替换掉原有的 startGame 函数
function startGame() {
  // 关键修复：直接从 DOM 元素读取最新的 slider 数值
  const selectedCount = parseInt(document.getElementById('citySlider').value);
  
  // 随机洗牌并截取
  cities = [...DB].sort(() => Math.random() - 0.5).slice(0, selectedCount);
  
  // 更新 UI 上的总数显示
  document.getElementById('total').textContent = cities.length;
  
  // 切换界面状态
  document.getElementById('startModal').style.display = 'none';
  document.getElementById('viewport').style.display = 'block';
  document.getElementById('statsPanel').style.display = 'block';
  
  // 生成传送带卡片
  const belt = document.getElementById('belt');
  belt.innerHTML = '';
  cities.forEach(c => {
    const el = document.createElement('div'); 
    el.className = 'city-card';
    el.innerHTML = `<span class="city-name-cn">${c.cn}</span><span class="city-name-en">${c.en}</span>`;
    belt.appendChild(el);
  });

  // 启动计时器
  started = true; 
  startTime = Date.now();
  timer = setInterval(() => {
    const d = Date.now() - startTime;
    document.getElementById('time').textContent = 
      `${Math.floor(d/60000).toString().padStart(2,'0')}:${Math.floor((d%60000)/1000).toString().padStart(2,'0')}`;
  }, 1000);

  updateConveyor();
}
